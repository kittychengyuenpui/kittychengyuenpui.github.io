import{u as e,d as l,_ as s}from"./chunk-C1P6SOVG.js";import{a6 as t,r as a,o as n,w as o,aR as u,W as i,X as c,F as r,a_ as d,aC as p,u as m,a3 as b,bJ as f,bz as h,by as v,U as x,be as k,aE as C}from"./chunk-BB7IEB5B.js";import{s as w}from"./chunk-BqjzUA-v.js";import{l as g}from"./chunk-D3YcvhA7.js";import"./chunk-DyqAhB7D.js";import"./chunk-B8dymozY.js";import"./chunk-CShO9xrd.js";import"./chunk-BP0RZxjf.js";import"./chunk-yaJDdhye.js";import"./chunk-DorFIKXF.js";import"./chunk-Brhz0LsG.js";import"./chunk-DCTqbsaT.js";import"./chunk-C6Zwkpkb.js";import"./chunk-BLnK4V6m.js";import"./chunk-Q9bklZT_.js";import"./chunk-iVZSWji-.js";import"./chunk-6OeFQMrk.js";import"./chunk-D6zm6W2C.js";import"./chunk-Cjrd7Wf_.js";import"./chunk-Dq6ymT-8.js";const y={class:"p-0 m-0"},U={class:"max-w-xs mb-10 form-control"},j={class:"flex flex-col items-center gap-2 pt-5"},z={class:"w-1/2 max-w-xs mb-10 form-control"},L=["onUpdate:modelValue"],P={class:"w-1/2 max-w-xs mb-10 form-control"},V=["checked","onChange"],A={class:"w-1/2 max-w-xs mb-10 form-control"},S=["onUpdate:modelValue","onChange"],_=["data-tip"],D=["value","max"],O={class:"w-1/2 max-w-xs mb-10 form-control"},q=["checked","onChange"],I={class:"w-full max-w-xs mb-10 form-control"},M=["onUpdate:modelValue"],N={key:0,value:{id:"",name:"",url:""}},B=["value"],E={key:0,class:"w-full max-w-xs mb-10 form-control"},F=["onClick"],J={key:0,class:"flex flex-wrap w-full h-full gap-1 p-0 pt-1 m-0 cursor-pointer"},R=["data-tip"],T={key:1,class:"btn btn-secondary btn-xs"},W={class:"w-full max-w-xs mb-10 form-control"},X={class:"flex gap-2"},$=["onClick"],G=t({__name:"PrizeConfig",setup(t){const G=g.createInstance({name:"imgStore"}),H=e().prizeConfig,K=e().globalConfig,{getPrizeConfig:Q,getCurrentPrize:Y}=w(H),{getImageList:Z}=w(K),ee=a(Q),le=a([]),se=a(),te=()=>{const e={id:(new Date).getTime().toString(),name:"獎項",sort:0,isAll:!1,count:1,isUsedCount:0,picture:{id:"",name:"",url:""},separateCount:{enable:!1,countList:[]},desc:"",isUsed:!1,isShow:!0,frequency:1};H.addPrizeConfig(e)},ae=e=>{se.value.separateCount.countList=e,se.value=null},ne=()=>{H.resetDefault()},oe=(e,l)=>{const s=ee.value.indexOf(e);1==l?(ee.value.splice(s,1),ee.value.splice(s-1,0,e)):(ee.value.splice(s,1),ee.value.splice(s+1,0,e))},ue=async()=>{await H.deleteAllPrizeConfig()};return n((()=>{(async()=>{(await G.keys()).length>0&&G.iterate(((e,l)=>{le.value.push({key:l,value:e})}))})()})),o((()=>ee.value),(e=>{H.setPrizeConfig(e)}),{deep:!0}),(e,t)=>{var a,n;const o=s;return u(),i("div",null,[t[8]||(t[8]=c("h2",null,"獎項配置",-1)),c("div",{class:"flex w-full gap-3"},[c("button",{class:"btn btn-info btn-sm",onClick:te},"添加"),c("button",{class:"btn btn-info btn-sm",onClick:ne},"默認列表"),c("button",{class:"btn btn-error btn-sm",onClick:ue},"全部删除")]),t[9]||(t[9]=c("div",{role:"alert",class:"w-fit my-4 alert alert-info"},[c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"w-6 h-6 stroke-current shrink-0"},[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),c("span",null,"進行操作可能會重置數據，請謹慎操作")],-1)),c("ul",y,[(u(!0),i(r,null,d(ee.value,(e=>(u(),i("li",{key:e.id,class:p(["flex gap-10",m(Y).id==e.id?"border-1 border-dotted rounded-xl":null])},[c("label",U,[c("div",j,[b(o,{class:p(["cursor-pointer hover:text-blue-400",0==ee.value.indexOf(e)?"opacity-0 cursor-default":""]),name:"up",onClick:l=>oe(e,1)},null,8,["class","onClick"]),b(o,{class:p(["cursor-pointer hover:text-blue-400",ee.value.indexOf(e)==ee.value.length-1?"opacity-0 cursor-default":""]),name:"down",onClick:l=>oe(e,0)},null,8,["onClick","class"])])]),c("label",z,[t[0]||(t[0]=c("div",{class:"label"},[c("span",{class:"label-text"},"名稱")],-1)),f(c("input",{type:"text","onUpdate:modelValue":l=>e.name=l,placeholder:"名稱",class:"w-full max-w-xs input-sm input input-bordered"},null,8,L),[[h,e.name]])]),c("label",P,[t[1]||(t[1]=c("div",{class:"label"},[c("span",{class:"label-text"},"全員参加")],-1)),c("input",{type:"checkbox",checked:e.isAll,onChange:l=>e.isAll=!e.isAll,class:"mt-2 border-solid checkbox checkbox-secondary border-1"},null,40,V)]),c("label",A,[t[2]||(t[2]=c("div",{class:"label"},[c("span",{class:"label-text"},"抽獎人數")],-1)),f(c("input",{type:"number","onUpdate:modelValue":l=>e.count=l,placeholder:"获獎人數",onChange:l=>(e=>{let l=-1;for(let s=0;s<ee.value.length;s++)if(ee.value[s].id==e.id){l=s;break}l>-1&&(ee.value[l].separateCount.countList=[],ee.value[l].isUsed?ee.value[l].isUsedCount=ee.value[l].count:ee.value[l].isUsedCount=0)})(e),class:"w-full max-w-xs p-0 m-0 input-sm input input-bordered"},null,40,S),[[h,e.count]]),c("div",{class:"tooltip tooltip-bottom","data-tip":"已抽取:"+e.isUsedCount+"/"+e.count},[c("progress",{class:"w-full progress",value:e.isUsedCount,max:e.count},null,8,D)],8,_)]),c("label",O,[t[3]||(t[3]=c("div",{class:"label"},[c("span",{class:"label-text"},"已抽取")],-1)),c("input",{type:"checkbox",checked:e.isUsed,onChange:l=>(e=>{e.isUsed?e.isUsedCount=0:e.isUsedCount=e.count,e.separateCount.countList=[],e.isUsed=!e.isUsed})(e),class:"mt-2 border-solid checkbox checkbox-secondary border-1"},null,40,q)]),c("label",I,[t[5]||(t[5]=c("div",{class:"label"},[c("span",{class:"label-text"},"圖片")],-1)),f(c("select",{class:"w-full max-w-xs select select-warning select-sm","onUpdate:modelValue":l=>e.picture=l},[e.picture.id?(u(),i("option",N,"❌")):x("",!0),t[4]||(t[4]=c("option",{disabled:"",selected:""},"選擇一张圖片",-1)),(u(!0),i(r,null,d(m(Z),(e=>(u(),i("option",{key:e.id,value:e},k(e.name),9,B)))),128))],8,M),[[v,e.picture]])]),e.separateCount?(u(),i("label",E,[t[6]||(t[6]=c("div",{class:"label"},[c("span",{class:"label-text"},"單次抽取個數")],-1)),c("div",{class:"flex justify-start w-full h-full",onClick:l=>(e=>{se.value=e,se.value.isUsedCount=0,se.value.isUsed=!1,se.value.separateCount.countList.length>1||(se.value.separateCount={enable:!0,countList:[{id:"0",count:e.count,isUsedCount:0}]})})(e)},[e.separateCount.countList.length?(u(),i("ul",J,[(u(!0),i(r,null,d(e.separateCount.countList,(e=>(u(),i("li",{class:"relative flex items-center justify-center w-8 h-8 bg-slate-600/60 separated",key:e.id},[c("div",{class:"flex items-center justify-center w-full h-full tooltip","data-tip":"已抽取:"+e.isUsedCount+"/"+e.count},[c("div",{class:"absolute left-0 z-50 h-full bg-blue-300/80",style:C(`width:${100*e.isUsedCount/e.count}%`)},null,4),c("span",null,k(e.count),1)],8,R)])))),128))])):(u(),i("button",T,"設置"))],8,F)])):x("",!0),c("label",W,[t[7]||(t[7]=c("div",{class:"label"},[c("span",{class:"label-text"},"操作")],-1)),c("div",X,[c("button",{class:"btn btn-error btn-sm",onClick:l=>(e=>{H.deletePrizeConfig(e.id)})(e)},"删除",8,$)])])],2)))),128))]),b(l,{totalNumber:null==(a=se.value)?void 0:a.count,"separated-number":null==(n=se.value)?void 0:n.separateCount.countList,onSubmitData:ae},null,8,["totalNumber","separated-number"])])}}});export{G as default};
